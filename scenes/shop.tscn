[gd_scene load_steps=20 format=3 uid="uid://c010sfubpw1uv"]

[ext_resource type="Script" path="res://scripts/shop.gd" id="1_5d4uv"]
[ext_resource type="PackedScene" uid="uid://c4y3fbn5as1i3" path="res://scenes/forge.tscn" id="3_w4lt2"]
[ext_resource type="Script" path="res://addons/dialogue_nodes/objects/dialogueBox.gd" id="4_0l17v"]
[ext_resource type="Resource" uid="uid://dfuhyrlqc0q1n" path="res://dialogues/order_1.tres" id="5_0eop8"]
[ext_resource type="PackedScene" uid="uid://85wqf6pegevs" path="res://scenes/outgoing_order.tscn" id="5_q02lg"]
[ext_resource type="Script" path="res://addons/dialogue_nodes/objects/bbcodeWait.gd" id="6_xy4cx"]
[ext_resource type="Script" path="res://addons/dialogue_nodes/objects/bbcodeGhost.gd" id="7_65erp"]
[ext_resource type="Script" path="res://scripts/commands/run_mission.gd" id="9_m5gx2"]
[ext_resource type="Resource" uid="uid://cxrotaaabbgs" path="res://data/catacombs.tres" id="9_w2gox"]
[ext_resource type="Script" path="res://scripts/commands/order_pool.gd" id="10_cm2da"]
[ext_resource type="Script" path="res://scripts/commands/run_dialogue.gd" id="11_m17v7"]
[ext_resource type="Resource" uid="uid://ba3cwbeyfo4a4" path="res://dialogues/big_project_1.tres" id="11_wvwid"]
[ext_resource type="Resource" uid="uid://dbbfnurrnfoem" path="res://dialogues/reward.tres" id="12_a7c0g"]
[ext_resource type="Script" path="res://scripts/commands/extract_variables_from_dialogue.gd" id="13_bedk2"]
[ext_resource type="Script" path="res://scripts/commands/track_big_project_completion.gd" id="13_vxdqf"]
[ext_resource type="Script" path="res://scripts/commands/present_big_project.gd" id="14_yd7gf"]
[ext_resource type="Script" path="res://scripts/commands/fill_in_reward_dialogue.gd" id="16_0gtg7"]

[sub_resource type="RichTextEffect" id="RichTextEffect_ceoyu"]
script = ExtResource("6_xy4cx")

[sub_resource type="RichTextEffect" id="RichTextEffect_w1wkq"]
script = ExtResource("7_65erp")

[node name="Shop" type="Node2D"]
script = ExtResource("1_5d4uv")

[node name="ReputationLabel" type="Label" parent="."]
offset_right = 40.0
offset_bottom = 23.0
text = "Reputation:"

[node name="IncomingOrder" type="Control" parent="."]
layout_mode = 3
anchors_preset = 0
size_flags_horizontal = 3
size_flags_vertical = 3

[node name="DialogueBox" type="Panel" parent="IncomingOrder"]
visible = false
custom_minimum_size = Vector2(256, 128)
layout_mode = 1
anchors_preset = 7
anchor_left = 0.5
anchor_top = 1.0
anchor_right = 0.5
anchor_bottom = 1.0
offset_left = 154.0
offset_top = 407.0
offset_right = 1054.0
offset_bottom = 622.0
grow_horizontal = 2
grow_vertical = 0
script = ExtResource("4_0l17v")
dialogue_data = ExtResource("5_0eop8")
start_id = "1"
options_vertical = true
custom_effects = Array[RichTextEffect]([SubResource("RichTextEffect_ceoyu"), SubResource("RichTextEffect_w1wkq")])

[node name="Forge" parent="." instance=ExtResource("3_w4lt2")]

[node name="OutgoingOrder" parent="." instance=ExtResource("5_q02lg")]

[node name="Commands" type="Node" parent="."]

[node name="RunMission" type="Node" parent="Commands"]
script = ExtResource("9_m5gx2")
missions = Array[Resource("res://scripts/data_scripts/mission_data.gd")]([ExtResource("9_w2gox")])

[node name="RunDialogue" type="Node" parent="Commands" node_paths=PackedStringArray("dialogue_box")]
script = ExtResource("11_m17v7")
dialogue_box = NodePath("../../IncomingOrder/DialogueBox")

[node name="ExtractVariableFromDialogue" type="Node" parent="Commands" node_paths=PackedStringArray("dialogue_box")]
script = ExtResource("13_bedk2")
dialogue_box = NodePath("../../IncomingOrder/DialogueBox")

[node name="RunBigProjectDialogue" type="Node" parent="Commands" node_paths=PackedStringArray("dialogue_box")]
script = ExtResource("14_yd7gf")
dialogue_box = NodePath("../../IncomingOrder/DialogueBox")

[node name="TrackBigProjectCompletion" type="Node" parent="Commands"]
script = ExtResource("13_vxdqf")

[node name="FillInRewardDialogue" type="Node" parent="Commands" node_paths=PackedStringArray("dialogue_box")]
script = ExtResource("16_0gtg7")
dialogue_box = NodePath("../../IncomingOrder/DialogueBox")
reward_dialogue = ExtResource("12_a7c0g")

[node name="Models" type="Node" parent="."]

[node name="Inventory" type="Node" parent="Models"]
script = ExtResource("13_vxdqf")

[node name="OrderPool" type="Node" parent="Models"]
script = ExtResource("10_cm2da")
orders_in = Array[Resource("res://addons/dialogue_nodes/objects/DialogueData.gd")]([ExtResource("11_wvwid"), ExtResource("5_0eop8")])

[connection signal="ready_state" from="." to="Models/OrderPool" method="_on_shop_ready_state"]
[connection signal="dialogue_ended" from="IncomingOrder/DialogueBox" to="Commands/RunDialogue" method="_on_dialogue_box_dialogue_ended"]
[connection signal="dialogue_ended" from="IncomingOrder/DialogueBox" to="Commands/ExtractVariableFromDialogue" method="_on_dialogue_box_dialogue_ended"]
[connection signal="dialogue_ended" from="IncomingOrder/DialogueBox" to="Commands/RunBigProjectDialogue" method="_on_dialogue_box_dialogue_ended"]
[connection signal="forged" from="Forge" to="." method="_on_forge_forged"]
[connection signal="turned_in" from="OutgoingOrder" to="." method="_on_outgoing_order_turned_in"]
[connection signal="completed" from="Commands/RunMission" to="Commands/FillInRewardDialogue" method="_on_run_mission_completed"]
[connection signal="ended" from="Commands/RunDialogue" to="." method="_on_run_dialogue_ended"]
[connection signal="big_project_updated" from="Commands/TrackBigProjectCompletion" to="." method="_on_track_big_project_completion_big_project_updated"]
[connection signal="reward_dialogue_created" from="Commands/FillInRewardDialogue" to="Models/OrderPool" method="_on_fill_in_reward_dialogue_reward_dialogue_created"]
[connection signal="big_project_updated" from="Models/Inventory" to="." method="_on_track_big_project_completion_big_project_updated"]
[connection signal="popped" from="Models/OrderPool" to="Commands/RunDialogue" method="_on_order_pool_popped"]
